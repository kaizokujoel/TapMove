# Prompt 3: Move Contract Deployment to Movement Testnet

## Objective
Deploy the TapMove Move contracts to Movement testnet and configure all apps with deployed addresses.

## Pre-requisites
1. **Read issues first**: Check `docs/issues/move/README.md` and `docs/issues/movement/README.md` for deployment learnings
2. **Load skill**: `skill: "move-contracts"`
3. **Aptos CLI installed**: `aptos --version`

## Context
Contracts exist in `/contracts/sources/` but need deployment. Currently using placeholder addresses.

## Tasks

### 1. Verify contract compilation
```bash
cd contracts
aptos move compile
```

Fix any compilation errors before proceeding.

### 2. Create Movement testnet profile
```bash
# Initialize Aptos config if not exists
aptos init --network custom --rest-url https://aptos.testnet.porto.movementlabs.xyz/v1

# Or add profile to existing config
aptos init --profile movement-testnet --network custom \
  --rest-url https://aptos.testnet.porto.movementlabs.xyz/v1
```

### 3. Fund deployer account
Get testnet MOVE tokens from Movement faucet:
- Visit: https://faucet.movementlabs.xyz/
- Or use CLI if available

### 4. Deploy contracts
```bash
cd contracts
aptos move publish --profile movement-testnet --assume-yes
```

Record the deployed module address.

### 5. Update deployment config
Update `contracts/deployment.config.json`:
```json
{
  "testnet": {
    "network": "movement-testnet",
    "rpc": "https://aptos.testnet.porto.movementlabs.xyz/v1",
    "modules": {
      "payment": "0x{DEPLOYED_ADDRESS}::payment",
      "merchant": "0x{DEPLOYED_ADDRESS}::merchant"
    },
    "deployer": "0x{DEPLOYER_ADDRESS}",
    "deployedAt": "2024-XX-XX"
  }
}
```

### 6. Update backend constants
Update `backend/src/lib/utils.js` or create `backend/src/lib/constants.js`:
```javascript
export const MOVEMENT_CONFIG = {
  RPC_URL: process.env.MOVEMENT_RPC_URL || 'https://aptos.testnet.porto.movementlabs.xyz/v1',
  FAUCET_URL: process.env.MOVEMENT_FAUCET_URL || 'https://faucet.testnet.porto.movementlabs.xyz',
  PAYMENT_MODULE: process.env.PAYMENT_MODULE || '0x{ADDRESS}::payment',
  MERCHANT_MODULE: process.env.MERCHANT_MODULE || '0x{ADDRESS}::merchant',
  USDC_ADDRESS: process.env.USDC_ADDRESS || '0x{USDC_COIN_ADDRESS}'
};
```

### 7. Update mobile app constants
Update `mobile/constants/network.ts`:
```typescript
export const MOVEMENT_TESTNET = {
  name: 'Movement Testnet',
  chainId: 'movement-testnet',
  rpcUrl: 'https://aptos.testnet.porto.movementlabs.xyz/v1',
  paymentModule: '0x{ADDRESS}::payment',
  merchantModule: '0x{ADDRESS}::merchant',
  usdcAddress: '0x{USDC_ADDRESS}',
};
```

### 8. Update merchant app constants
Update `merchant/src/lib/constants.ts` (create if needed):
```typescript
export const MOVEMENT_CONFIG = {
  rpcUrl: process.env.NEXT_PUBLIC_MOVEMENT_RPC || 'https://aptos.testnet.porto.movementlabs.xyz/v1',
  paymentModule: process.env.NEXT_PUBLIC_PAYMENT_MODULE || '0x{ADDRESS}::payment',
  merchantModule: process.env.NEXT_PUBLIC_MERCHANT_MODULE || '0x{ADDRESS}::merchant',
};
```

### 9. Create .env.example files
Create environment templates for each app with all required variables.

## Verification
```bash
# Verify contract is deployed
aptos move view --function-id '{ADDRESS}::merchant::is_merchant' \
  --args address:0x1 --profile movement-testnet

# Test from backend
curl http://localhost:3001/api/wallet/account-info/{ADDRESS}
```

## Files to Create/Modify
- `contracts/deployment.config.json` (MODIFY)
- `backend/src/lib/constants.js` (NEW or MODIFY)
- `backend/.env.example` (CREATE)
- `mobile/constants/network.ts` (MODIFY)
- `mobile/.env.example` (CREATE)
- `merchant/src/lib/constants.ts` (CREATE or MODIFY)
- `merchant/.env.example` (CREATE)

## Movement Network Details
- Testnet RPC: `https://aptos.testnet.porto.movementlabs.xyz/v1`
- Faucet: `https://faucet.movementlabs.xyz/`
- Explorer: `https://explorer.movementlabs.xyz/`

## DO NOT
- Deploy to mainnet
- Hardcode private keys in code
- Skip environment variable setup
